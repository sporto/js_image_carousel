var Carousel=function(p,S){var M=this;var I=p;var O;var N=0;var m=[];var ae=0;var f=0;var P=[];var R=0;var D=[];var L=0;var H;var i;var n=true;var T=1000;var G=false;var K=[];var x;var V=0;if(S.speed){T=S.speed}if(S.debug){G=S.debug}Y();function Y(){k("init");N=I.width();$("figure",I).wrapAll("<div class='movable' />");O=$(".movable",I);Q();I.css("position","relative");I.css("overflow-x","hidden");O.css("position","absolute");C();l();$("figure",I).click(v);y();r();z();A()}function Q(){k("processOriginalItems");m=$("figure",I);$("figure",I).each(function(af,ag){K[af]=$("figcaption",this);$("figcaption",this).hide()});k(K);m.fadeTo(0,0.5);m.css("float","left");$("figure img",I).each(function(){var af=$(this).width();P.push(af);D.push(af);f+=af;ae++});R=f}function l(){k("makePreItems");var af=ae-1;k("clonedIndex "+af);var ag=P[af];k("clonedWidth "+ag);var ah=$(m[af]).clone();D.unshift(ag);R+=ag;O.prepend(ah);j(-ag);U();L++;V++}function C(){k("makePostItems");var ag=0;var af=0;while((R)<(N*2.5)){ag++;if(ag>15){k("Too many!!!");break}if(af>=ae){af=0}E(af);af++}}function E(af){k("clonePostItem "+af);var ag=P[af];var ah=$(m[af]).clone();D.push(ag);R+=ag;O.append(ah);U()}function U(){O.width(R)}function r(){H=$("<div class='arrow previous' />");i=$("<div class='arrow next' />");H.appendTo(I);i.appendTo(I);H.click(X);i.click(Z)}function y(){x=$("<div class='caption' />");x.appendTo(I)}function X(af){if(n){ac()}}function Z(af){if(n){ad()}}function v(ag){var af=$(this).index();d(af)}function ac(){s(-1)}function ad(){s(1)}function s(af){d(L+af)}function d(ah){k("-------moveTo "+ah);k("_currentIndex "+L);if(ah===L){return}n=false;t(L);u();if(ah===L){return}var af=ah-L;k("indexDif "+af);var ag=0;if(ah<L){ag=h();k("shifted "+ag);ah+=(ag*ae)}if(ah>L){ag=a();k("shifted "+ag);ah-=(ag*ae)}k("new toIndex "+ah);W(L,ah);L=ah;z()}function J(ah,ai){if(ah<0){throw ("fromIndex invalid "+ah)}if(ai<0){throw ("toIndex invalid "+ai)}k("getDifference");k("fromIndex "+ah);k("toIndex "+ai);if(ah===ai){return 0}var ag=0;if(ah>ai){k("Backwards");for(var af=ai;af<ah;af++){ag+=D[af]}return ag}if(ah<ai){k("Forward");for(var af=ah;af<ai;af++){ag+=D[af]}return -ag}}function W(ag,ai){k("animate");k("fromIndex "+ag);k("toIndex"+ai);var af=J(ag,ai);k("dif "+af);var ah=o()+af;k("newLeft "+ah);O.animate({left:ah},T,c)}function c(){k("animateDone");n=true;q();A()}function q(){k("showItemCaption");var af=m[L]}function o(){return O.position().left}function w(){return o()+B()}function b(af){O.css("left",af)}function B(){return R}function j(af){b(o()+af)}function h(){var af=0;while(g()){af++}return af}function g(){k("shiftMovableOneLeft");var ah=L+m.length;var ag=(w()-f)>=N;var af=ah<D.length;if(ag&&af){j(-f);L=ah;k("new currentIndex "+L);return true}else{k("Cannot more the movable left any further");return false}}function a(){var af=0;while(F()){af++}return af}function F(){k("shiftMovableOneRight");var ag=L-m.length;k("newCurrentIndex "+ag);var af=ag>=0;k("check "+af);if(af){j(f);L=ag;k("new currentIndex "+L);return true}else{k("Cannot move movable right any further");return false}}function z(){k("addCurrentHighlight "+L);ab(L)}function ab(af){k("addHighlight "+af);$("figure",I).eq(af).fadeTo(0,1)}function t(af){$("figure",I).eq(af).fadeTo(0,0.5);$("figcaption",I).eq(af).hide()}function A(){k("showCurrentCaption "+L);e(L-V)}function e(af){k("showCaption "+af);af=aa(af);var ag=K[af];ag.show();x.html(ag);x.fadeIn(500)}function u(){x.hide()}function aa(af){return af%m.length}function k(af){if(!G){return}if(console.log){console.log(af)}}};